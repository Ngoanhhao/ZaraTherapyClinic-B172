<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZaraTherapyClinic</title>
    <link rel="icon" type="image/x-icon" href="assets/Img/logo_web.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/shopping.css">
    <link rel="stylesheet" href="assets/font/Roboto/stylesheet.css">
    <link rel="stylesheet" href="assets/bootstrap-5.2.0-beta1-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/font/fontawesome-free-6.1.1-web/css/all.min.css">
    <link rel="stylesheet" href="assets/bootstrap-5.2.0-beta1-dist/css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="assets/bootstrap-5.2.0-beta1-dist/css/bootstrap-reboot.min.css">
    <script src="assets/bootstrap-5.2.0-beta1-dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/jquery/jquery-3.6.0.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="assets/carousel/owl.carousel.min.css">
    <script src="assets/carousel/owl.carousel.js"></script>
</head>

<body class="scroll">
    <!-- NAV -->
    <nav class="navbar navbar-expand-xl bg-white">

    </nav>


    <!-- BODY -->
    <div class="cart container">
        <div class="cart-container">
            <div class="cart-top">
                <h1>Shopping bag</h1>
                <p class="s-14">Your Selected Items</p>
                <hr>
            </div>

            <div class="list-item">
                <div class="cart-item">
                    <table class="table s-16">
                        <tr class="text-center">
                            <th>Products</th>
                            <th>Unit Price</th>
                            <th>Quantity</th>
                            <th>Total Price</th>
                        </tr>
                        <!-- <tr class="product-item">
                            <td class="d-flex align-items-center">
                                <div class="img-product">
                                    <img src="./assets/Img/products/environ/08092016-174826-skin_essentia_avst_moisturiser_1.png"
                                        alt="">
                                </div>
                                <div class="content-product text-primary">
                                    Environ Vita-Antioxidant AVST1 Moisturiser
                                </div>
                            </td>
                            <td>
                                <p class="s-16">50$</p>
                            </td>
                            <td class="p-0" style="width: 100px;">
                                <div class="btn-group" role="group" aria-label="Basic outlined example">
                                    <button type="button" data-id="${IDproducts[i]}"
                                        class="btn btn-outline-primary s-16">-</button>
                                    <input type="number" class="text-center s-16 ${IDproducts[i]}" value="5">
                                    <button type="button" data-id="${IDproducts[i]}"
                                        class="btn btn-outline-primary s-16">+</button>
                                </div>
                            </td>
                            <td>
                                <p class="s-16">250$</p>
                                <div class="text-end p-20 pe-5">
                                    <i class="fa-solid fa-circle-xmark s-18 w-auto" id="close1"></i>
                                </div>
                            </td>
                        </tr> -->

                    </table>
                </div>
            </div>
            <div class="cart-bot-container">
                <h2 class="text-center empty">Your bag is empty</h2>
                <div class="cart-bot pt-2 justify-content-between">
                    <h2 style="margin-left: 5%;">Total</h2>
                    <h2 style="margin-right: 6%;">0$</h2>
                </div>
            </div>
        </div>
        <button type="button" class="btn d-block m-auto proceed w-100 mt-4 mb-5">
            <h1>Buy</h1>
        </button>
    </div>

    <!-- footer -->

    <div class="footer w-100"></div>

    <!-- login -->
    <div class="background-signup justify-content-center align-items-center"></div>
    <div id="toast"></div>

</body>

</html>
<script src="./assets/nav.js"></script>
<script src="./assets/signup.js"></script>
<script src="./assets/footer.js"></script>
<script src="./assets/countUp/countUp.js"></script>
<script src="./assets/products.js"></script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script>

    $(document).ready(function () {
        var IDproducts = JSON.parse(localStorage.getItem("IDproducts"));
        var Prices = [];
        var Newproduct = [];
        var id;
        var total = 0;
        // create khung
        for (let i = 0; i < IDproducts.length; i++) {
            $("table tbody").append('<tr class="product-item"></tr>')
            $(`tr:nth-child(${i + 2})`).html(`
                    <td class="d-flex align-items-sm-center row">

                        <div class="img-product col-sm-3 col-3">
                            <img src=""alt="">
                        </div>
                        <div class=" col-sm-9 col-9 row flex-column justify-content-between">
                            <div class="content-product text-primary name col-12"></div>
                            <div class="col-12">
                                <div class="btn-group d-sm-none" role="group" aria-label="Basic outlined example">
                                    <button type="button" data-id="" class="btn btn-outline-primary s-16">-</button>
                                    <input type="number" class="text-center s-16" value="" readonly>
                                    <button type="button" data-id="" class="btn btn-outline-primary s-16">+</button>
                                </div>
                                <div>
                                    <p class="s-16 total-mb d-sm-none" data-price="" id="" data-quantity-item=""></p>
                                </div>
                                <div class="text-end p-20 pe-md-4 pe-sm-1 d-sm-none close-mb">
                                    <p class=" s-14 w-auto" id="close1" data-remove="">Remove</p>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <p class="s-16 price"></p>
                    </td>
                    <td class="p-0" style="width: 100px;">
                        <div class="btn-group" role="group" aria-label="Basic outlined example">
                            <button type="button" data-id="" class="btn btn-outline-primary s-16">-</button>
                            <input type="number" class="text-center s-16" value="" readonly>
                            <button type="button" data-id="" class="btn btn-outline-primary s-16">+</button>
                        </div>
                    </td>
                    <td>
                        <p class="s-16" data-price="" id="" data-quantity-item=""></p>
                        <div class="text-end p-20 pe-md-4 pe-sm-1">
                            <i class="fa-solid fa-circle-xmark s-18 w-auto" id="close1" data-remove=""></i>
                        </div>
                    </td>
            `)
        }
        // add data
        for (let i = 0; i < IDproducts.length; i++) {
            Newproduct[i] = JSON.parse(localStorage.getItem(IDproducts[i]))
            var name = Newproduct[i].name;
            id = Newproduct[i].id;
            switch (name) {
                case "environs":
                    $(`tr:nth-child(${i + 2}) .img-product img`).attr("src", `${environs[id].img}`)
                    $(`tr:nth-child(${i + 2}) .name`).text(`${environs[id].name}`)
                    $(`tr:nth-child(${i + 2}) .price`).text(`${environs[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("data-price", `${environs[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("id", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child .total-mb`).addClass(`${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child i`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child p`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p, tr:nth-child(${i + 2}) td:first-child .total-mb`).text(`${Prices[i] = parseInt(environs[id].price) * parseInt(Newproduct[i].quatity)}$`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr(`data-quantity-item`, i)
                    break;
                case "murad":
                    $(`tr:nth-child(${i + 2}) .img-product img`).attr("src", `${murad[id].img}`)
                    $(`tr:nth-child(${i + 2}) .name`).text(`${murad[id].name}`)
                    $(`tr:nth-child(${i + 2}) .price`).text(`${murad[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("data-price", `${murad[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("id", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child .total-mb`).addClass(`${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child i`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child p`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p, tr:nth-child(${i + 2}) td:first-child .total-mb`).text(`${Prices[i] = parseInt(murad[id].price) * parseInt(Newproduct[i].quatity)}$`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr(`data-quantity-item`, i)

                    break;
                case "equipments":
                    $(`tr:nth-child(${i + 2}) .img-product img`).attr("src", `${equipments[id].img}`)
                    $(`tr:nth-child(${i + 2}) .name`).text(`${equipments[id].name}`)
                    $(`tr:nth-child(${i + 2}) .price`).text(`${equipments[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("data-price", `${equipments[id].price}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr("id", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child .total-mb`).addClass(`${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child i`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:first-child p`).attr("data-remove", `${IDproducts[i]}`)
                    $(`tr:nth-child(${i + 2}) td:last-child p, tr:nth-child(${i + 2}) td:first-child .total-mb`).text(`${Prices[i] = parseInt(equipments[id].price) * parseInt(Newproduct[i].quatity)}$`)
                    $(`tr:nth-child(${i + 2}) td:last-child p`).attr(`data-quantity-item`, i)
                    break;
            }

            $(`tr:nth-child(${i + 2}) .btn-group input`).val(`${Newproduct[i].quatity}`)
            $(`tr:nth-child(${i + 2}) .btn-group input`).addClass(`${IDproducts[i]}`)
            $(`tr:nth-child(${i + 2}) .btn-group button:first-child, tr:nth-child(${i + 2}) .btn-group button:last-child`).attr("data-id", `${IDproducts[i]}`)
        }
        repairTotalbill()

        // 
        if (IDproducts.length) {
            $(".cart-item .table").show()
            $(".cart-bot, .cart-bot-container hr").css("display", "flex")
            $(".cart-bot-container .empty").hide()
        }


        // xác nhận mua sản phẩm
        $(".proceed").click(function () {
            // checklogin
            if ((localStorage.getItem("login")) == null) {
                $(".register2").css("animation", "");
                $(".signupp").css("animation", "");
                $(".register").css("animation", "");
                $(".background-signup").css("display", "flex");
            }else{
                location.reload()
                localStorage.clear()
            }
        })

        // quatity
        $("tr .btn-group button:first-child").click(function () {
            let id = $(this).data("id");
            // lấy quantity từ localstorage - rồi add lại
            let newp = JSON.parse(localStorage.getItem(id));
            newp.quatity -= 1;
            if (newp.quatity < 1) {
                newp.quatity = 1;
            }
            localStorage.setItem(id, JSON.stringify(newp));
            // add quantity vào value sau khi đã giảm vào html
            $("." + id).val(newp.quatity);
            // add total money vào content sau khi giảm
            $("#" + id).text(newp.quatity * parseInt($("#" + id).data("price")) + "$");
            // add total money cho giao diện mb
            $("." + id).text(newp.quatity * parseInt($("#" + id).data("price")) + "$");

            // repair total bill
            repairTotalbill()
        })
        $("tr .btn-group button:last-child").click(function () {
            let id = $(this).data("id");
            // lấy quantity từ localstorage + rồi add lại
            let newp = JSON.parse(localStorage.getItem(id));
            newp.quatity += 1;
            localStorage.setItem(id, JSON.stringify(newp));
            // add quantity vào value sau khi đã giảm vào html
            $("." + id).val(newp.quatity);
            // add total money vào content sau khi giảm
            $("#" + id).text(newp.quatity * parseInt($("#" + id).data("price")) + "$");
            // add total money cho giao diện mb
            $("." + id).text(newp.quatity * parseInt($("#" + id).data("price")) + "$");

            // repair total bill
            repairTotalbill()
        })
        function repairTotalbill() {
            let itemquatity = parseInt($("tr:last-child td:last-child p").attr("data-quantity-item"));
            let totalquatity = 0;
            for (let i = 0; i <= itemquatity; i++) {
                totalquatity += parseInt($(`tr:nth-child(${i + 2}) td:last-child p`).text());
            }
            $(".cart-bot h2:last-child").text(`${totalquatity}$`);
        }

        // remove
        $("tr td:last-child i, tr td:first-child p[id='close1']").click(function () {
            let dataremove = $(this).attr("data-remove")
            let newIDproducts = IDproducts.filter(item => item != dataremove)
            localStorage.setItem("IDproducts", JSON.stringify(newIDproducts))
            location.reload()
        })

    })





</script>